<div style="max-width: 960px;border: 1px solid&nbsp;#ccc;margin: 1em auto;padding: 1.5em 1.5em 1.5em 7em;background-color: white;box-shadow: 0 0 10px #ccc"><div style="padding-bottom: .5em;"><div><h1 id="working-with-internal-representations">Working with Internal Representations</h1>
</div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [1]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined">from pymbolic import parse

x = parse("x")
h = parse("h")</code></pre><div style="margin: 1em 0px .5em 0px;"></div></div></div><div style="padding-bottom: .5em;"><div><h2 id="visualizing-an-expression-tree">Visualizing an Expression Tree</h2>
</div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [2]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined">u = (x+4)**3

h = parse("h")

expr = u + 2*u*h + 4*u*h**2
</code></pre><div style="margin: 1em 0px .5em 0px;"></div></div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [3]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined"># Load an IPython extension for graph drawing
%load_ext gvmagic</code></pre><div style="margin: 1em 0px .5em 0px;"></div></div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [4]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined">from pymbolic.mapper.graphviz import GraphvizMapper

gvm = GraphvizMapper()
gvm(expr)</code></pre><div style="margin: 1em 0px .5em 0px;"></div></div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [5]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined">%dotstr gvm.get_dot_code()</code></pre><div style="margin: 1em 0px .5em 0px;"><div style="position: relative;"><div><div><!--?xml version="1.0" encoding="UTF-8" standalone="no"?-->

<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: expression Pages: 1 -->
<svg width="374pt" height="332pt" viewBox="0.00 0.00 374.00 332.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 328)">
<title>expression</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-328 370,-328 370,4 -4,4"></polygon>
<!-- id139855649446656 -->
<g id="node1" class="node"><title>id139855649446656</title>
<ellipse fill="none" stroke="black" cx="177" cy="-306" rx="18" ry="18"></ellipse>
<text text-anchor="middle" x="177" y="-302.3" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- id139855649446712 -->
<g id="node2" class="node"><title>id139855649446712</title>
<ellipse fill="none" stroke="black" cx="177" cy="-162" rx="33.2948" ry="18"></ellipse>
<text text-anchor="middle" x="177" y="-158.3" font-family="Times,serif" font-size="14.00">Power</text>
</g>
<!-- id139855649446656&#45;&gt;id139855649446712 -->
<g id="edge1" class="edge"><title>id139855649446656-&gt;id139855649446712</title>
<path fill="none" stroke="black" d="M177,-287.871C177,-263.67 177,-219.211 177,-190.393"></path>
<polygon fill="black" stroke="black" points="180.5,-190.189 177,-180.189 173.5,-190.189 180.5,-190.189"></polygon>
</g>
<!-- id139855649446768 -->
<g id="node7" class="node"><title>id139855649446768</title>
<ellipse fill="none" stroke="black" cx="115" cy="-234" rx="18" ry="18"></ellipse>
<text text-anchor="middle" x="115" y="-230.3" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- id139855649446656&#45;&gt;id139855649446768 -->
<g id="edge6" class="edge"><title>id139855649446656-&gt;id139855649446768</title>
<path fill="none" stroke="black" d="M165.338,-291.834C156.332,-281.665 143.7,-267.403 133.343,-255.71"></path>
<polygon fill="black" stroke="black" points="135.86,-253.273 126.609,-248.107 130.62,-257.914 135.86,-253.273"></polygon>
</g>
<!-- id139855649446936 -->
<g id="node10" class="node"><title>id139855649446936</title>
<ellipse fill="none" stroke="black" cx="242" cy="-234" rx="18" ry="18"></ellipse>
<text text-anchor="middle" x="242" y="-230.3" font-family="Times,serif" font-size="14.00">*</text>
</g>
<!-- id139855649446656&#45;&gt;id139855649446936 -->
<g id="edge10" class="edge"><title>id139855649446656-&gt;id139855649446936</title>
<path fill="none" stroke="black" d="M188.922,-292.161C198.543,-281.8 212.25,-267.038 223.325,-255.111"></path>
<polygon fill="black" stroke="black" points="225.914,-257.467 230.154,-247.758 220.784,-252.704 225.914,-257.467"></polygon>
</g>
<!-- id139855649446600 -->
<g id="node3" class="node"><title>id139855649446600</title>
<ellipse fill="none" stroke="black" cx="117" cy="-90" rx="18" ry="18"></ellipse>
<text text-anchor="middle" x="117" y="-86.3" font-family="Times,serif" font-size="14.00">+</text>
</g>
<!-- id139855649446712&#45;&gt;id139855649446600 -->
<g id="edge2" class="edge"><title>id139855649446712-&gt;id139855649446600</title>
<path fill="none" stroke="black" d="M163.684,-145.465C155.21,-135.579 144.133,-122.655 134.895,-111.878"></path>
<polygon fill="black" stroke="black" points="137.429,-109.456 128.264,-104.141 132.114,-114.011 137.429,-109.456"></polygon>
</g>
<!-- uid2 -->
<g id="node6" class="node"><title>uid2</title>
<ellipse fill="none" stroke="black" cx="180" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="180" y="-86.3" font-family="Times,serif" font-size="14.00">3</text>
</g>
<!-- id139855649446712&#45;&gt;uid2 -->
<g id="edge5" class="edge"><title>id139855649446712-&gt;uid2</title>
<path fill="none" stroke="black" d="M177.742,-143.697C178.072,-135.983 178.469,-126.712 178.838,-118.112"></path>
<polygon fill="black" stroke="black" points="182.335,-118.245 179.267,-108.104 175.342,-117.945 182.335,-118.245"></polygon>
</g>
<!-- uid0 -->
<g id="node4" class="node"><title>uid0</title>
<polygon fill="none" stroke="black" points="108,-36 54,-36 54,-0 108,-0 108,-36"></polygon>
<text text-anchor="middle" x="81" y="-14.3" font-family="Times,serif" font-size="14.00">x</text>
</g>
<!-- id139855649446600&#45;&gt;uid0 -->
<g id="edge3" class="edge"><title>id139855649446600-&gt;uid0</title>
<path fill="none" stroke="black" d="M109.01,-73.4647C104.785,-65.2479 99.4796,-54.9325 94.6261,-45.4952"></path>
<polygon fill="black" stroke="black" points="97.6659,-43.753 89.9799,-36.4609 91.4409,-46.9545 97.6659,-43.753"></polygon>
</g>
<!-- uid1 -->
<g id="node5" class="node"><title>uid1</title>
<ellipse fill="none" stroke="black" cx="153" cy="-18" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="153" y="-14.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- id139855649446600&#45;&gt;uid1 -->
<g id="edge4" class="edge"><title>id139855649446600-&gt;uid1</title>
<path fill="none" stroke="black" d="M124.99,-73.4647C129.385,-64.9181 134.948,-54.1011 139.956,-44.3633"></path>
<polygon fill="black" stroke="black" points="143.07,-45.9608 144.531,-35.4672 136.845,-42.7593 143.07,-45.9608"></polygon>
</g>
<!-- id139855649446768&#45;&gt;id139855649446712 -->
<g id="edge8" class="edge"><title>id139855649446768-&gt;id139855649446712</title>
<path fill="none" stroke="black" d="M126.662,-219.834C135.017,-210.4 146.492,-197.444 156.377,-186.284"></path>
<polygon fill="black" stroke="black" points="159.215,-188.358 163.226,-178.552 153.975,-183.717 159.215,-188.358"></polygon>
</g>
<!-- uid3 -->
<g id="node8" class="node"><title>uid3</title>
<ellipse fill="none" stroke="black" cx="99" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="99" y="-158.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- id139855649446768&#45;&gt;uid3 -->
<g id="edge7" class="edge"><title>id139855649446768-&gt;uid3</title>
<path fill="none" stroke="black" d="M111.127,-216.055C109.345,-208.261 107.188,-198.822 105.189,-190.079"></path>
<polygon fill="black" stroke="black" points="108.589,-189.244 102.949,-180.275 101.765,-190.804 108.589,-189.244"></polygon>
</g>
<!-- uid4 -->
<g id="node9" class="node"><title>uid4</title>
<polygon fill="none" stroke="black" points="54,-180 0,-180 0,-144 54,-144 54,-180"></polygon>
<text text-anchor="middle" x="27" y="-158.3" font-family="Times,serif" font-size="14.00">h</text>
</g>
<!-- id139855649446768&#45;&gt;uid4 -->
<g id="edge9" class="edge"><title>id139855649446768-&gt;uid4</title>
<path fill="none" stroke="black" d="M101.25,-222.062C89.3403,-212.589 71.6996,-198.556 56.6011,-186.546"></path>
<polygon fill="black" stroke="black" points="58.5321,-183.61 48.5272,-180.124 54.1744,-189.088 58.5321,-183.61"></polygon>
</g>
<!-- id139855649446936&#45;&gt;id139855649446712 -->
<g id="edge12" class="edge"><title>id139855649446936-&gt;id139855649446712</title>
<path fill="none" stroke="black" d="M230.078,-220.161C221.204,-210.604 208.853,-197.303 198.298,-185.936"></path>
<polygon fill="black" stroke="black" points="200.712,-183.392 191.342,-178.446 195.582,-188.155 200.712,-183.392"></polygon>
</g>
<!-- uid5 -->
<g id="node11" class="node"><title>uid5</title>
<ellipse fill="none" stroke="black" cx="339" cy="-162" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="339" y="-158.3" font-family="Times,serif" font-size="14.00">4</text>
</g>
<!-- id139855649446936&#45;&gt;uid5 -->
<g id="edge11" class="edge"><title>id139855649446936-&gt;uid5</title>
<path fill="none" stroke="black" d="M256.313,-222.671C271.167,-211.951 294.728,-194.949 312.906,-181.831"></path>
<polygon fill="black" stroke="black" points="315.275,-184.438 321.336,-175.748 311.178,-178.761 315.275,-184.438"></polygon>
</g>
<!-- id139855649446880 -->
<g id="node12" class="node"><title>id139855649446880</title>
<ellipse fill="none" stroke="black" cx="261" cy="-162" rx="33.2948" ry="18"></ellipse>
<text text-anchor="middle" x="261" y="-158.3" font-family="Times,serif" font-size="14.00">Power</text>
</g>
<!-- id139855649446936&#45;&gt;id139855649446880 -->
<g id="edge13" class="edge"><title>id139855649446936-&gt;id139855649446880</title>
<path fill="none" stroke="black" d="M246.503,-216.411C248.671,-208.421 251.326,-198.642 253.768,-189.645"></path>
<polygon fill="black" stroke="black" points="257.156,-190.524 256.398,-179.956 250.4,-188.69 257.156,-190.524"></polygon>
</g>
<!-- uid6 -->
<g id="node13" class="node"><title>uid6</title>
<polygon fill="none" stroke="black" points="285,-108 231,-108 231,-72 285,-72 285,-108"></polygon>
<text text-anchor="middle" x="258" y="-86.3" font-family="Times,serif" font-size="14.00">h</text>
</g>
<!-- id139855649446880&#45;&gt;uid6 -->
<g id="edge14" class="edge"><title>id139855649446880-&gt;uid6</title>
<path fill="none" stroke="black" d="M260.258,-143.697C259.928,-135.983 259.531,-126.712 259.162,-118.112"></path>
<polygon fill="black" stroke="black" points="262.658,-117.945 258.733,-108.104 255.665,-118.245 262.658,-117.945"></polygon>
</g>
<!-- uid7 -->
<g id="node14" class="node"><title>uid7</title>
<ellipse fill="none" stroke="black" cx="330" cy="-90" rx="27" ry="18"></ellipse>
<text text-anchor="middle" x="330" y="-86.3" font-family="Times,serif" font-size="14.00">2</text>
</g>
<!-- id139855649446880&#45;&gt;uid7 -->
<g id="edge15" class="edge"><title>id139855649446880-&gt;uid7</title>
<path fill="none" stroke="black" d="M275.972,-145.811C285.413,-136.234 297.762,-123.705 308.271,-113.044"></path>
<polygon fill="black" stroke="black" points="311.003,-115.258 315.53,-105.68 306.017,-110.344 311.003,-115.258"></polygon>
</g>
</g>
</svg>
</div></div></div></div></div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [22]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined">ec.compile(expr)</code></pre><div style="margin: 1em 0px .5em 0px;"><div style="position: relative;"><div><span style="display: block;position: absolute;top: 0 !important;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #de4815">Out [22]:</span><pre style="margin: 0px;">'pow(x + 4, 3) + 4 * pow(x + 4, 3) * h * h + 2 * pow(x + 4, 3) * h'</pre></div></div></div></div></div><div style="padding-bottom: .5em;"><div style="position: relative;"><span style="display: block;position: absolute;top: 5px;left: -7.5em;width: 7em;font-family: monospace;text-align: right;color: #303fba">In [ ]:</span><pre style="background: #f7f7f7;border: 1px solid #cfcfcf;padding: .4em;margin-bottom: 0;margin-top: 0;border-radius: 2px;min-height: .85em" class=" language-undefined"><code class=" language-undefined"></code></pre><div style="margin: 1em 0px .5em 0px;"></div></div></div></div>